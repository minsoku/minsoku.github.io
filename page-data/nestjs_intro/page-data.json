{"componentChunkName":"component---src-templates-blog-template-js","path":"/nestjs_intro/","result":{"data":{"cur":{"id":"7d83a617-af6b-5e99-98ac-405303db1e5a","html":"<h1 id=\"nestjs-소개\" style=\"position:relative;\"><a href=\"#nestjs-%EC%86%8C%EA%B0%9C\" aria-label=\"nestjs 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nestjs 소개</h1>\n<ul>\n<li><a href=\"https://nestjs.com/\">Nestjs</a>는 효율적이고 스케일링이 쉬운 nodejs 서버를 만드는데 사용하는 프레임워크이다.</li>\n<li>차세대 Javascript를 사용하며 Typescript로 만들어졌으며 Typescript를 완전히 지원한다.</li>\n<li>Nestjs는 Express 같은 견고한 HTTP 서버 프레임워크를 사용하고 있으며 원한다면 Fastify를 대신 사용할 수 있다.</li>\n<li>상당히 많은 Nodejs 라이브러리, 헬퍼, 툴들이 있음에도 불구하고 아키텍처 설계에 대한 문제를 해결해주는 해결책은 존재하지 않는다.</li>\n<li>Nestjs는 자체적으로 서버 아키텍쳐를 제공해준다. 그래서 테스트하기 쉽고, 디커플링이 잘 되어있고, 유지보수가 편한 서버를 제작하게 해준다.</li>\n</ul>\n<h1 id=\"nestjs-lifecycle\" style=\"position:relative;\"><a href=\"#nestjs-lifecycle\" aria-label=\"nestjs lifecycle permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nestjs LifeCycle</h1>\n<p><img src=\"https://velog.velcdn.com/images/minsoku03/post/b67672cd-fdea-4067-ab80-02e15b3ffdb3/image.png\" alt=\"\"></p>\n<h2 id=\"pipe\" style=\"position:relative;\"><a href=\"#pipe\" aria-label=\"pipe permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pipe</h2>\n<ul>\n<li>Pipe는 Injectable 데코레이터로 데코레이팅 되어있고, PipeTransform이라는 인터페이스를 implement한다.</li>\n<li>변형: 원하는 형태로 변형시켜준다 ex) string => integer</li>\n<li>검증: 만약에 유효한 데이터면 그대로 전달해주고 아닐 경우에는 에러를 던진다.</li>\n</ul>\n<h3 id=\"코드-예시\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C\" aria-label=\"코드 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test.pipe.ts\n\nimport {\n    ArgumentMetadata,\n    BadRequestException,\n    Injectable,\n    PipeTransform,\n} from '@nestjs/common';\n\n@Injectable()\nexport class TestPipe implements PipeTransform {\n    transform(value: any, metadata: ArgumentMetadata) {\n        if (value.content.toString().length > 10) {\n            throw new BadRequestException(\n                'content는 10자 미만으로 작성해주세요',\n            );\n        }\n        return value.toString();\n    }\n}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.controller.ts\n\n@Controller()\nexport class AppController {\n    constructor(private readonly appService: AppService) {}\n\n    @Get()\n    @UsePipes(TestPipe)\n    getHello(@Body() body: Ibody): string {\n        console.log(body);\n        return '성공';\n    }\n}</code></pre></div>\n<h3 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><code class=\"language-text\">\"message\": \"content는 10자 미만으로 작성해주세요\",</code></p>\n<p><code class=\"language-text\">\"error\": \"Bad Request\",</code></p>\n<p><code class=\"language-text\">\"statusCode\": 400</code></p>\n<h2 id=\"guard\" style=\"position:relative;\"><a href=\"#guard\" aria-label=\"guard permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Guard</h2>\n<ul>\n<li>Guard는 쉽게 말하면 보호하는 역할</li>\n<li>Guard는 api 요청이 들어갔을 때 (Controller, Service, Repository) 로직 처리 부분까지 갈 수 있냐 없냐를 결정하게 해주는 요소다.</li>\n<li>Pipe가 적용이 되기 훨씬 전에 Guard가 먼저 적용이 돼서 만약에 Guard에서 이번 요청은 들어갈 수가 없어라고 판단을 한다면 파이프까지의 요청이 이어지지도 않는다.</li>\n<li>Guard를 구현하는 것은 Pipe를 구현하는 것과 굉장히 비슷하다.</li>\n<li>Injectable 데코레이터로 데코레이팅하고, CanActivate라는 타입을 implement를 해준다.</li>\n</ul>\n<h3 id=\"코드-예시-1\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C-1\" aria-label=\"코드 예시 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test.guard.ts\n\nimport {\n    CanActivate,\n    ExecutionContext,\n    Injectable,\n    UnauthorizedException,\n} from '@nestjs/common';\n\n@Injectable()\nexport class TestGuard implements CanActivate {\n    canActivate(context: ExecutionContext): boolean {\n        const req = context.switchToHttp().getRequest();\n        const token = req.headers['authorization'];\n        if (!token) {\n            throw new UnauthorizedException('토큰이 없습니다 !!!!');\n        }\n        return true;\n    }\n}\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.controller.ts\n\n@Controller()\nexport class AppController {\n    constructor(private readonly appService: AppService) {}\n    @Get()\n    @UsePipes(TestPipe)\n    @UseGuards(TestGuard)\n    getHello(@Body() body: Ibody): string {\n        console.log(body);\n        return '성공';\n    }\n}</code></pre></div>\n<h3 id=\"결과-1\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-1\" aria-label=\"결과 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<ul>\n<li>Autorization을 안 넣었을 때</li>\n</ul>\n<p><img src=\"https://velog.velcdn.com/images/minsoku03/post/a5f9eeaa-ab9d-4efa-b469-31c4d57451dd/image.png\" alt=\"\"></p>\n<ul>\n<li>Autorization을 넣었을 때</li>\n</ul>\n<p><img src=\"https://velog.velcdn.com/images/minsoku03/post/ae49af58-8478-480c-8742-968275504912/image.png\" alt=\"\"></p>\n<h2 id=\"interceptor\" style=\"position:relative;\"><a href=\"#interceptor\" aria-label=\"interceptor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Interceptor</h2>\n<ul>\n<li>메서드를 실행하기 전과 후로 우리가 추가 로직을 작성을 할 수가 있다.</li>\n<li>함수에서 반환된 결과를 우리가 변형할 수 있다.</li>\n<li>함수에서 던진 에러를 우리가 변형할 수 있다.</li>\n<li>기본으로 작성해놓은 함수로직에 추가 기능을 넣을 수가 있다.</li>\n<li>어떤 함수의 기능을 완전히 override할 수가 있다.</li>\n<li>Nestjs 라이프사이클에서 볼 수 있는 모든 기능 중에서 유일하게 요청과 응답을 모두 핸들링할 수 있는 기능이다.</li>\n<li>또 보통 로그를 쌓는 기능은 Interceptor에서 수행된다.</li>\n</ul>\n<p><img src=\"https://velog.velcdn.com/images/minsoku03/post/7df6346c-4e2d-4268-a9da-fb00fb029998/image.png\" alt=\"\"></p>\n<ul>\n<li>위를 보면 Client Side(App, Web or server)가 있다.</li>\n<li>요청이 들어가서 Route Handler(포스트, 게시글 등등) 여기로 요청이 들어가면 Interceptor가 한 번 Intercepting을 한다.</li>\n<li>이 요청을 변경하거나 그대로 둘 수 있다.</li>\n<li>그다음에 요청이 processing이 되고 Route Handler에서 함수가 실행이 되고 다시 응답으로 Client Side로 보내질 때, 그때 한 번 더 Interceptor가 적용이 된다.</li>\n<li>Request용 Interceptor, Response용 Interceptor를 따로 작성을 하는 게, 아니고 Interceptor 하나에서 이 두 가지를 모두 핸들링할 수 있는 것이 Interceptor의 특장이다.</li>\n<li>ExceptionFilter(예외상황처리라 예외) Interceptor가 유일하게 응답값까지 변경을 할 수 있는 기능이다.</li>\n<li>Interceptor는 Observable이라는 것을 반환하고 Rxjs를 사용한다. 그리고 Injectable 데코레이터로 데코레이팅하고 NestInterceptor를 implement 한다.</li>\n</ul>\n<h3 id=\"코드-예시-2\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C-2\" aria-label=\"코드 예시 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 예시</h3>\n<ul>\n<li>request를 보냈을 때, response를 받았을 때를 console로 출력하고 밀리초 단위로 얼마나 차이가 나는지에 대한 예시코드</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test.interceptor.ts\n\nimport {\n    CallHandler,\n    ExecutionContext,\n    Injectable,\n    NestInterceptor,\n} from '@nestjs/common';\nimport { Observable, tap } from 'rxjs';\n\n@Injectable()\nexport class TestInterceptor implements NestInterceptor {\n    intercept(\n        context: ExecutionContext,\n        next: CallHandler&lt;any>,\n    ): Observable&lt;any> {\n        const now = new Date();\n        console.log(`[REQ] ${now.toLocaleString('kr')}`);\n        return next\n            .handle()\n            .pipe(\n                tap((observable) =>\n                    console.log(\n                        `[RES] ${new Date().toLocaleString('kr')} ${\n                            new Date().getMilliseconds() - now.getMilliseconds()\n                        }`,\n                    ),\n                ),\n            );\n    }\n}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.controller.ts\n\n@Controller()\nexport class AppController {\n    constructor(private readonly appService: AppService) {}\n    @Get()\n    @UsePipes(TestPipe)\n    @UseGuards(TestGuard)\n    @UseInterceptors(TestInterceptor)\n    getHello(@Body() body: Ibody): string {\n        return '성공';\n    }\n}</code></pre></div>\n<h3 id=\"결과-2\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-2\" aria-label=\"결과 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><code class=\"language-text\">[REQ] 12/14/2023, 5:33:51 PM</code></p>\n<p><code class=\"language-text\">[RES] 12/14/2023, 5:33:51 PM 4</code></p>\n<h2 id=\"exceptionfilter\" style=\"position:relative;\"><a href=\"#exceptionfilter\" aria-label=\"exceptionfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ExceptionFilter</h2>\n<ul>\n<li>ExceptionFilter는 말 그대로 예외를 필터링하는 것이다.</li>\n<li>예외가 일어났을 때 그 특정 예외를 잡아 가지고 형태를 변경한다던지, 특정 응답을 보내는 등의 여러가지 작업을 할 수가 있다.</li>\n<li>ExceptionFilter는 에러처리에 대한 로깅 로직을 작성하기 좋은 위치에 있다.</li>\n<li>ExceptionFilter는 먼저 Controller, Service, Repository의 로직 처리 후 ExceptionFilter가 적용이 되고 Interceptor로 전달이 된다.</li>\n<li>ExceptionFilter에서 수행한 부분들은 Interceptor에서 마찬가지로 또 추가 처리를 할 수가 있다.</li>\n</ul>\n<p><img src=\"https://velog.velcdn.com/images/minsoku03/post/85b9ce03-a85d-4884-b0a7-0812ffc92cad/image.png\" alt=\"\"></p>\n<ul>\n<li>클라이언트 사이드에서 요청을 보내고, 요청을 처리하는 부분에서 응답이 돌아갈 때 Filter가 적용이 된다.</li>\n</ul>\n<h3 id=\"코드-예시-3\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C-3\" aria-label=\"코드 예시 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 예시</h3>\n<ul>\n<li>ExceptionFilter는 Catch로 데코레이팅이 되고 ExceptionFilter를 implement한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test.exceptionFilter.ts\n\nimport {\n    ArgumentsHost,\n    Catch,\n    ExceptionFilter,\n    HttpException,\n} from '@nestjs/common';\n\n@Catch(HttpException)\nexport class HttpExceptionFilter implements ExceptionFilter {\n    catch(exception: HttpException, host: ArgumentsHost) {\n        const ctx = host.switchToHttp();\n        const response = ctx.getResponse();\n        const request = ctx.getRequest();\n        const status = exception.getStatus();\n\n        response.status(status).json({\n            statusCode: status,\n            message: exception.message,\n            timestamp: new Date().toLocaleDateString('kr'),\n            path: request.url,\n        });\n    }\n}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.controller.ts\n\n@Controller()\nexport class AppController {\n    constructor(private readonly appService: AppService) {}\n    @Get()\n    @UsePipes(TestPipe)\n    @UseGuards(TestGuard)\n    @UseInterceptors(TestInterceptor)\n    @UseFilters(HttpExceptionFilter)\n    getHello(@Body() body: Ibody): string {\n        throw new BadRequestException('에러라고합니다 !');\n        return '성공';\n    }\n}</code></pre></div>\n<h3 id=\"결과-3\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-3\" aria-label=\"결과 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><code class=\"language-text\">\"statusCode\": 400</code></p>\n<p><code class=\"language-text\">\"message\": \"에러라고합니다 !\"</code></p>\n<p><code class=\"language-text\">\"timestamp\": \"12/14/2023\"</code></p>\n<p><code class=\"language-text\">\"path\": \"/\"</code></p>\n<ul>\n<li>이렇게 하나의 endpoint에 적용할 수도 있고, 전체에 적용할 수 있습니다.</li>\n</ul>\n<h3 id=\"전체에-exceptionfilter를-적용하는-코드-예시\" style=\"position:relative;\"><a href=\"#%EC%A0%84%EC%B2%B4%EC%97%90-exceptionfilter%EB%A5%BC-%EC%A0%81%EC%9A%A9%ED%95%98%EB%8A%94-%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C\" aria-label=\"전체에 exceptionfilter를 적용하는 코드 예시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전체에 ExceptionFilter를 적용하는 코드 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">main.ts\n\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { HttpExceptionFilter } from 'src/exception-filter/test.exceptionFilter';\n\nasync function bootstrap() {\n    const app = await NestFactory.create(AppModule);\n    await app.listen(3000);\n\n    app.useGlobalFilters(new HttpExceptionFilter());\n}\nbootstrap();\n</code></pre></div>\n<h2 id=\"middleware\" style=\"position:relative;\"><a href=\"#middleware\" aria-label=\"middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Middleware</h2>\n<p>MiddleWare가 가장 먼저 요청을 받는 역할을 한다.</p>\n<ul>\n<li>어떤 코드든 실행할 수 있다.</li>\n<li>요청과 응답 객체의 변화를 우리가 만들어 줄 수 있다. (무언가를 추가하거나 삭제하거나 업데이트가 가능)</li>\n<li>요청이 끝나기전에 우리가 중간에 중지를 할 수 있다.</li>\n<li>MiddleWare를 원한다면 여러개를 계속 적용을 할 수가 있다.</li>\n<li>만약에 현재 MiddleWare가 요청 사이클을 중지시키지 않고 에러 같은 것을 던지지 않으면 다음 MiddleWare에다가 요청을 넘기기 위해서 next 함수를 불러야 된다. (안 그러면 그대로 멈춤)</li>\n</ul>\n<h3 id=\"코드-에시\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%97%90%EC%8B%9C\" aria-label=\"코드 에시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 에시</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test.middleware.ts\n\nimport { NestMiddleware } from '@nestjs/common';\nimport { NextFunction } from 'express';\n\nexport class TestMiddleWare implements NestMiddleware {\n    use(req: Request, res: Response, next: NextFunction) {\n        console.log(\n            `[REQ] ${req.url} ${req.method} ${new Date().toLocaleString('kr')}`,\n        );\n        next();\n    }\n}</code></pre></div>\n<ul>\n<li>다른 라이프사이클과 다른 점은 middleware는 modlue에 작성을 한다.</li>\n<li>NestModule를 implements를 하고 path, method로 원하는 값을 받을 수 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.module.ts\n\nimport {\n    MiddlewareConsumer,\n    Module,\n    NestModule,\n    RequestMethod,\n} from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { TestMiddleWare } from 'src/middleware/test.middleware';\n\n@Module({\n    imports: [],\n    controllers: [AppController],\n    providers: [AppService],\n})\nexport class AppModule implements NestModule {\n    configure(consumer: MiddlewareConsumer) {\n        consumer.apply(TestMiddleWare).forRoutes({\n            path: '/',\n            method: RequestMethod.ALL,\n        });\n    }\n}\n</code></pre></div>\n<h3 id=\"결과-4\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-4\" aria-label=\"결과 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h3>\n<p><code class=\"language-text\">[REQ] / GET 12/14/2023, 6:24:48 PM</code></p>","excerpt":"Nestjs 소개 Nestjs는 효율적이고 스케일링이 쉬운 nodejs 서버를 만드는데 사용하는 프레임워크이다. 차세대 Javascript를 사용하며 Typescript로 만들어졌으며 Typescript를 완전히 지원한다. Nestjs는 Express 같은 견고한 HTTP 서버 프레임워크를 사용하고 있으며 원한다면 Fastify를 대신 사용할 수 있다. 상당히 많은 Nodejs 라이브러리, 헬퍼, 툴들이 있음에도 불구하고 아키텍처 설계에 대한 문제를 해결해주는 해결책은 존재하지 않는다. Nestjs는 자체적으로 서버 아키텍쳐를 제공해준다. 그래서 테스트하기 쉽고, 디커플링이 잘 되어있고, 유지보수가 편한 서버를 제작하게 해준다. Nestjs LifeCycle  Pipe Pipe는 Injectable 데코레이터로 데코레이팅 되어있고, PipeTransform이라는 인터페이스를 implement한다. 변형: 원하는 형태로 변형시켜준다 ex) string => integer 검증: 만약…","frontmatter":{"date":"December 24, 2023","title":"Nestjs 소개 및 라이프사이클","categories":"nestjs","author":"minsoku","emoji":""},"fields":{"slug":"/nestjs_intro/"}},"next":null,"prev":null},"pageContext":{"slug":"/nestjs_intro/","nextSlug":"","prevSlug":""}},"staticQueryHashes":["1956554647","2938748437"]}